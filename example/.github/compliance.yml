version: 1
organization: "FormanceHQ"  # Optional if the action runs in single-repo mode

defaults:
  merge_methods:
    allow_merge_commit: false
    allow_squash_merge: true
    allow_rebase_merge: false

  branch_protection:
    patterns: ["main", "release/v*", "releases/v*"]
    enforce_admins: true
    required_reviews:
      dismiss_stale_reviews: true
      required_approving_review_count: 1
      require_code_owner_reviews: false
      require_last_push_approval: false
    required_status_checks:
      auto_discover: true        # Discover recent checks (build/test/lint)
      contexts: []               # If not empty, replaces discovery
      strict: true
    restrictions:
      users: []
      teams: ["admin"]
    allow_force_pushes: false
    allow_deletions: false
    required_conversation_resolution: true
    lock_branch: false
    allow_fork_syncing: false

  security:
    secret_scanning: "enabled"                 # required
    secret_scanning_push_protection: "auto"    # "enabled" for public, otherwise info
    dependabot_alerts: false                   # info-only if false
    dependabot_updates: false                  # info-only if false
    code_scanning_recommended: true            # info-only: requires dedicated workflow

  permissions:
    remove_individual_collaborators: true
    teams:
      - team: "admin"
        permission: "admin"
      - team: "core"
        permission: "write"
      - team: "platform"
        permission: "maintain"

  archived_repos:
    admin_team_only: true

# Targeted rules by repositories (glob patterns) and/or attributes
rules:
  - match:
      repositories: ["*-archived"]
    apply:
      archived_repos:
        admin_team_only: true
      permissions:
        remove_individual_collaborators: true

  - match:
      repositories: ["*.github.io", "test-*"]
    apply:
      branch_protection: {}   # implicitly disables if not applicable
      permissions:
        teams: []              # no specific adjustment

  - match:
      only_private: true
    apply:
      security:
        secret_scanning_push_protection: "enabled"

# Enable/disable checks (if omitted, all enabled)
checks:
  enabled: ["merge-methods", "team-permissions", "branch-protection", "security-scanning", "archived-repos"]